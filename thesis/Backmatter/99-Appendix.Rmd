\printbibliography[heading=bibintoc,title={Bibliography}]
\cleardoublepage 
\appendix

\chapter{Some probability functions}

This chapter serves as a reference, specifying notation, properties, and moments related to the various distributions used in this master thesis.

\begin{table}[h!]
\centering
  \resizebox{\textwidth}{!}{\begin{tabular}{m{0.12\textwidth}m{0.2\textwidth}m{0.50\textwidth}m{0.09\textwidth}m{0.09\textwidth}}
    \toprule
    Name & Support & Density & $\E[Y]$ & $\V[Y]$ \\
    \midrule
    Poisson \newline $\Pois(\lambda)$ & $0, 1, 2,\dots$ \newline $\lambda \in \mathbb{R}_{+}$ & $\frac{\lambda^{y}}{y!}\exp(-\lambda)$ & $\lambda$ & $\lambda$ \\
    \midrule
    Gamma \newline $\G(\alpha,\beta)$ & $\mathbb{R_{+}}$ \newline $\alpha \in \mathbb{R}_{+}, \beta \in \mathbb{R}_{+}$ & $\frac{1}{\Gamma(\alpha)\beta}\Big(\frac{y}{\beta}\Big)^{\alpha-1}\exp(-y/\beta)$ & $\alpha\beta$ & $\alpha\beta^2$ \\
    \midrule
    Neg. Bin. \newline $\NB(r,p)$ & $0, 1, 2,\dots$ \newline $r\in\mathbb{R}_+, p \in]0,1]$ & $\begin{pmatrix} r+y-1 \\ y \end{pmatrix} p^r(1-p)^y$ & $\frac{r(1+p)}{p}$ & $\frac{r(1-p)}{p^2}$ \\
    \midrule
    Normal \newline $\N(\mu, \sigma^2)$ & $\mathbb{R}$ \newline $\mu\in\mathbb{R}, \sigma^2\in\mathbb{R}_+$ & $\frac{1}{\sigma\sqrt{2\pi}}\exp\Big(-\frac{(y-\mu)^2}{2\sigma^2}\Big)$ & $\mu$ & $\sigma^2$ \\
    \bottomrule
  \end{tabular}}
  \caption{Density, support, mean value, and variance for a number of distributions used in this master thesis.}
  \label{table:probabilityFunctions}
\end{table}


\chapter{C++ templates for the negative joint log-likelihood}\label{cpp}

This chapter present the user template for the hierarchical Poisson Gamma model specified in \eqref{eq:PoisGam}.

```{Rcpp, eval=FALSE}
#include <TMB.hpp>
template<class Type>
Type objective_function<Type>::operator() ()
{
  // Data
  DATA_VECTOR(y);                             // Count data
  DATA_VECTOR(x);                             // Population size
  DATA_MATRIX(X);                             // Design matrix
  // Parameters
  PARAMETER_VECTOR(beta);                     // Fixed effects parameters
  PARAMETER(log_phi_u);                       // Model parameter
  vector<Type> lambda  = exp(X*beta-log(x));  // Construct 'lambda'
  Type phi_u = exp(log_phi_u);                // And the model parameters
  Type r = 1/phi_u;                           // Construct the size
  vector<Type> p = 1/(lambda*phi_u+1);        // And the prob. parameter
  // Objective function
  Type f = -sum(dnbinom(y, r, p,true));       // Calculate the objective
  return f;
}
```

\chapter{State-of-the-art detection algorithm}

\section{Controls}\label{controlsStateOfTheArt}

In the function `farringtonFlexible`, users can select either the original Farrington method or the improved method by Noufaily by specifying the appropriate `control` arguments. The choice of algorithm variant is determined by the contents of the `control` slot. In the example provided, `con.farrington` indicates the use of the original method, while `con.noufaily` represents the options for the improved method.

\subsection{Case studies}

Here, the specific `control` arguments used in the case studies is provided.

```{r ControlsLIST, eval=FALSE}

con.farrington <- list(
  range = NULL, b = 3, w = 2,
  reweight = TRUE, weightsThreshold = 1,
  verbose = TRUE, glmWarnings = TRUE,
  alpha = 0.05, trend = TRUE, pThresholdTrend = 0.05,
  limit54 = c(0,4), powertrans = "2/3",
  fitFun = "algo.farrington.fitGLM.flexible",
  populationOffset = TRUE,
  noPeriods = 1, pastWeeksNotIncluded = NULL,
  thersholdMethod = "delta"
)

con.noufaily <- list(
  range = NULL, b = 3, w = 2,
  reweight = TRUE, weightsThreshold = 2.58,
  verbose = TRUE, glmWarnings = TRUE,
  alpha = 0.05, trend = TRUE, pThresholdTrend = 1,
  limit54 = c(0,4), powertrans = "2/3",
  fitFun = "algo.farrington.fitGLM.flexible",
  populationOffset = TRUE,
  noPeriods = 10, pastWeeksNotIncluded = NULL,
  thersholdMethod = "nbPlugin"
)

```

\subsection{Simulation study}

Here, the specific `control` arguments used in the simulation studies is provided.

```{r ControlsLISTSim, eval=FALSE}

con.farrington <- list(
  range = NULL, b = 5, w = 3,
  reweight = TRUE, weightsThreshold = 1,
  verbose = TRUE, glmWarnings = TRUE,
  alpha = 0.005, trend = TRUE, pThresholdTrend = 0.05,
  limit54 = c(0,4), powertrans = "2/3",
  fitFun = "algo.farrington.fitGLM.flexible",
  populationOffset = TRUE,
  noPeriods = 1, pastWeeksNotIncluded  = 3,
  thersholdMethod = "delta"
)

con.noufaily <- list(
  range = NULL, b = 5, w = 3,
  reweight = TRUE, weightsThreshold = 2.58,
  verbose = TRUE, glmWarnings = TRUE,
  alpha = 0.005, trend = TRUE, pThresholdTrend = 0.05,
  limit54 = c(0,4), powertrans = "2/3",
  fitFun = "algo.farrington.fitGLM.flexible",
  populationOffset = TRUE,
  noPeriods = 10, pastWeeksNotIncluded  = 26,
  thersholdMethod = "nbPlugin"
)

```

\chapter{Outbreak data}\label{FUDData}

```{r FUD, echo=FALSE}
SSI_FUD %>%
    select(Pathogen, `No. of patients` = No_of_patients, Setting, `Suspected source` = Suspected_source, `FUD no.` = FUD_no) %>%
  kbl(booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = paste0("Food- and waterborne disease outbreaks of LIST, SHIL, STEC, and SALM reported in the Food- and waterborne Outbreak Database (FUD) (n=",n_SSI_FUD$n,"), 2008-2022."),
      linesep = "") %>%
  kable_paper(full_width = TRUE, latex_options = c("repeat_header", "HOLD_position")) %>%
  column_spec(1, width = "4.5cm") %>%
  column_spec(2, width = "1.5cm") %>%
  column_spec(3, width = "4cm") %>%
  column_spec(4, width = "3cm") %>%
  column_spec(5, width = "0.5cm")
```



In this chapter an excerpt of the results

```{r LISTStateOfTheArtTbl, echo=FALSE}

LIST_alarms_StateOfTheArt %>%
  select(Date, ageGroup, method, y, threshold, alarm) %>%
  pivot_wider(names_from = method, values_from = c(threshold, alarm)) %>%
  select(Date, `Age group` = ageGroup, `$y_t$` = y, Treshold.1 = threshold_Farrington, Alarm.1 = alarm_Farrington, Threshold.2 = threshold_Noufaily, Alarm.2 = alarm_Noufaily) %>%
  kbl(booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Longtable",
      col.names = gsub("\\.\\d", "", names(.))) %>%
  kable_paper(latex_options = c("repeat_header"),  repeat_header_method = c("replace")) %>%
  add_header_above(c(" " = 3, "Farrington" = 2, "Noufaily" = 2)) %>%
  column_spec(1, bold = TRUE) %>%
  collapse_rows(columns = 1)

```

```{r SHILStateOfTheArtTbl, echo=FALSE, eval=FALSE}

SHIL_alarms_StateOfTheArt %>%
  select(Date, ageGroup, method, y, threshold, alarm) %>%
  pivot_wider(names_from = method, values_from = c(threshold, alarm)) %>%
  select(Date, `Age group` = ageGroup, `$y_t$` = y, Treshold.1 = threshold_Farrington, Alarm.1 = alarm_Farrington, Threshold.2 = threshold_Noufaily, Alarm.2 = alarm_Noufaily) %>%
  kbl(booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Longtable",
      col.names = gsub("\\.\\d", "", names(.))) %>%
  kable_paper(latex_options = c("repeat_header"),  repeat_header_method = c("replace")) %>%
  add_header_above(c(" " = 3, "Farrington" = 2, "Noufaily" = 2)) %>%
  column_spec(1, bold = TRUE) %>%
  collapse_rows(columns = 1)

```

```{r STECStateOfTheArtTbl, echo=FALSE, eval=FALSE}

STEC_alarms_StateOfTheArt %>%
  select(Date, ageGroup, method, y, threshold, alarm) %>%
  pivot_wider(names_from = method, values_from = c(threshold, alarm)) %>%
  select(Date, `Age group` = ageGroup, `$y_t$` = y, Treshold.1 = threshold_Farrington, Alarm.1 = alarm_Farrington, Threshold.2 = threshold_Noufaily, Alarm.2 = alarm_Noufaily) %>%
  kbl(booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Longtable",
      col.names = gsub("\\.\\d", "", names(.))) %>%
  kable_paper(latex_options = c("repeat_header"),  repeat_header_method = c("replace")) %>%
  add_header_above(c(" " = 3, "Farrington" = 2, "Noufaily" = 2)) %>%
  column_spec(1, bold = TRUE) %>%
  collapse_rows(columns = 1)

```

```{r SALMStateOfTheArtTbl, echo=FALSE, eval=FALSE}

SALM_alarms_StateOfTheArt %>%
  select(Date, ageGroup, method, y, threshold, alarm) %>%
  pivot_wider(names_from = method, values_from = c(threshold, alarm)) %>%
  select(Date, `Age group` = ageGroup, `$y_t$` = y, Treshold.1 = threshold_Farrington, Alarm.1 = alarm_Farrington, Threshold.2 = threshold_Noufaily, Alarm.2 = alarm_Noufaily) %>%
  kbl(booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Longtable",
      col.names = gsub("\\.\\d", "", names(.))) %>%
  kable_paper(latex_options = c("repeat_header"),  repeat_header_method = c("replace")) %>%
  add_header_above(c(" " = 3, "Farrington" = 2, "Noufaily" = 2)) %>%
  column_spec(1, bold = TRUE) %>%
  collapse_rows(columns = 1)

```


\chapter{Figures and Tables related to the case studies}\label{FigAndTabCaseStudy}

\section{\textit{Listeriosis}}

```{r LISTNovelTblAppendix, echo=FALSE}

LIST_novel_tbl %>%
    mutate(`95\\% CI` = paste0("[",round(CI.lwr,2),", ",round(CI.upr,2),"]"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         avgLogS = paste0("$\\bar{S}(G,y)=", round(avgLogS,2),"$"),
         Parameter = case_when(
           Parameter == "ageGroup<65 years" ~ "$\\hat{\\beta}_{<65 years}$",
           Parameter == "ageGroup65+ years" ~ "$\\hat{\\beta}_{65+ years}$",
           Parameter == "log_sigma" ~ "$\\log(\\hat{\\sigma})$",
           Parameter == "log_phi" ~ "$\\log(\\hat{\\phi})$"
         )) %>%
  mutate(Formula = case_when(
    Formula == "ageGroup" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})\\end{math}"
  )) %>%
  select(`   ` = Model, `  ` = Formula, ` ` = avgLogS, Parameter, Estimate = theta, `95\\% CI`) %>%
  kbl(booktabs = TRUE, escape = FALSE, align = "l", longtable = TRUE, caption = "LIST modeling results. The average logarithmic score, $\\bar{S}(G, y)$, is computed for all the fixed effects models. The parameters are estimated in a rolling window with width $k=36$ and the estimates at time $t_0$, i.e. the last time point, are presented in this table for both modeling frameworks. Confidence intervals for the parameter estimates are calculated using 95\\% profile likelihood confidence intervals.") %>%
  kable_paper(latex_options = c("repeat_header", "HOLD_position"), repeat_header_method = c("replace")) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                valign = "middle",
                custom_latex_hline = 1:3)

```

(ref:LISTnovelparplot) Considering LIST in the time period between January 2011 and December 2022. Estimate (solid line) and 95% profile likelihood confidence interval (dashed line) of $\hat\theta$ for the considered fixed effects models estimated using the rolling window with a width of $k=36$ months. 

```{r LISTnovelparplot, echo=FALSE, out.width="100%", fig.cap="(ref:LISTnovelparplot)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/LIST_novel_par_plot.png")
```


\section{\textit{Shigellosis}}

(ref:SHILSSIoutbreaks) Timeline plot indicating the start (triangle) and duration (line) of documented outbreaks of SHIL by SSI and possible collaborators.

```{r SHILSSIoutbreaks, echo=FALSE, out.width="100%", fig.cap="(ref:SHILSSIoutbreaks)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/SHIL_SSI_outbreaks.png")
```

```{r SHILNovelTblAppendix, echo=FALSE}

SHIL_novel_tbl %>%
  mutate(`95\\% CI` = paste0("[",round(CI.lwr,2),", ",round(CI.upr,2),"]"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         avgLogS = paste0("$\\bar{S}(G,y)=", round(avgLogS,2),"$"),
         Parameter = case_when(
           Parameter == "ageGroup<25 years" ~ "$\\hat{\\beta}_{<25 years}$",
           Parameter == "ageGroup25+ years" ~ "$\\hat{\\beta}_{25+ years}$",
           Parameter == "t" ~ "$\\hat{\\beta}_{trend}$",
           Parameter == "log_sigma" ~ "$\\log(\\hat{\\sigma})$",
           Parameter == "log_phi" ~ "$\\log(\\hat{\\phi})$",
           Parameter == "sin(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\sin}$",
           Parameter == "cos(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\cos}$"
         )) %>%
  mutate(Formula = case_when(
    Formula == "ageGroup" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t +\\log(n_{it})\\end{math}",
    Formula == "ageGroup_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{\\sin}\\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t + \\beta_{\\sin} \\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}"
  )) %>%
  select(`   ` = Model, `  ` = Formula, ` ` = avgLogS, Parameter, Estimate = theta, `95\\% CI`) %>%
  kbl(booktabs = TRUE, escape = FALSE, align = "l", longtable = TRUE, caption = "SHIL modeling results. The average logarithmic score, $\\bar{S}(G, y)$, is computed for all the fixed effects models. The parameters are estimated in a rolling window with width $k=36$ and the estimates at time $t_0$, i.e. the last time point, are presented in this table for both modeling frameworks. Confidence intervals for the parameter estimates are calculated using 95\\% profile likelihood confidence intervals.") %>%
  kable_paper(latex_options = c("repeat_header", "HOLD_position"), repeat_header_method = c("replace")) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                valign = "middle",
                custom_latex_hline = 1:3)

```

(ref:SHILnovelparplot) Considering SHIL in the time period between January 2011 and December 2022. Estimate (solid line) and 95% profile likelihood confidence interval (dashed line) of $\hat\theta$ for the considered fixed effects models estimated using the rolling window with a width of $k=36$ months. 

```{r SHILnovelparplot, echo=FALSE, out.width="100%", fig.cap="(ref:SHILnovelparplot)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/SHIL_novel_par_plot.png")
```


\section{Shiga toxin (verotoxin)-producing \textit{Escherichia coli}}

(ref:STECSSIoutbreaks) Timeline plot indicating the start (triangle) and duration (line) of documented outbreaks of \gls{STEC} by \gls{SSI} and possible collaborators.

```{r STECSSIoutbreaks, echo=FALSE, out.width="100%", fig.cap="(ref:STECSSIoutbreaks)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/STEC_SSI_outbreaks.png")
```

```{r STECNovelTblAppendix, echo=FALSE}

STEC_novel_tbl %>%
  mutate(`95\\% CI` = paste0("[",round(CI.lwr,2),", ",round(CI.upr,2),"]"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         avgLogS = paste0("$\\bar{S}(G,y)=", round(avgLogS,2),"$"),
         Parameter = case_when(
           Parameter == "ageGroup<1 year" ~ "$\\hat{\\beta}_{<1 year}$",
           Parameter == "ageGroup1-4 years" ~ "$\\hat{\\beta}_{1-4 years}$",
           Parameter == "ageGroup5-14 years" ~ "$\\hat{\\beta}_{5-14 years}$",
           Parameter == "ageGroup15-24 years" ~ "$\\hat{\\beta}_{15-24 years}$",
           Parameter == "ageGroup25-64 years" ~ "$\\hat{\\beta}_{25-64 years}$",
           Parameter == "ageGroup<65 years" ~ "$\\hat{\\beta}_{<65 years}$",
           Parameter == "ageGroup65+ years" ~ "$\\hat{\\beta}_{65+ years}$",
           Parameter == "t" ~ "$\\hat{\\beta}_{trend}$",
           Parameter == "log_sigma" ~ "$\\log(\\hat{\\sigma})$",
           Parameter == "log_phi" ~ "$\\log(\\hat{\\phi})$",
           Parameter == "sin(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\sin}$",
           Parameter == "cos(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\cos}$"
         )) %>%
  mutate(Formula = case_when(
    Formula == "ageGroup" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t +\\log(n_{it})\\end{math}",
    Formula == "ageGroup_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{\\sin}\\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t + \\beta_{\\sin} \\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}"
  )) %>%
  select(`   ` = Model, `  ` = Formula, ` ` = avgLogS, Parameter, Estimate = theta, `95\\% CI`) %>%
  kbl(booktabs = TRUE, escape = FALSE, align = "l", longtable = TRUE, caption = "STEC modeling results. The average logarithmic score, $\\bar{S}(G, y)$, is computed for all the fixed effects models. The parameters are estimated in a rolling window with width $k=36$ and the estimates at time $t_0$, i.e. the last time point, are presented in this table for both modeling frameworks. Confidence intervals for the parameter estimates are calculated using 95\\% profile likelihood confidence intervals.") %>%
  kable_paper(latex_options = c("repeat_header", "HOLD_position"), repeat_header_method = c("replace")) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                valign = "middle",
                custom_latex_hline = 1:3)

```

(ref:STECnovelparplot) Considering STEC in the time period between January 2011 and December 2022. Estimate (solid line) and 95% profile likelihood confidence interval (dashed line) of $\hat\theta$ for the considered fixed effects models estimated using the rolling window with a width of $k=36$ months. 

```{r STECnovelparplot, echo=FALSE, out.width="100%", fig.cap="(ref:STECnovelparplot)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/STEC_novel_par_plot.png")
```

\section{\textit{Salmonellosis}}

```{r SALMNovelTblAppendix, echo=FALSE}

SALM_novel_tbl %>%
    mutate(`95\\% CI` = paste0("[",round(CI.lwr,2),", ",round(CI.upr,2),"]"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         avgLogS = paste0("$\\bar{S}(G,y)=", round(avgLogS,2),"$"),
         Parameter = case_when(
           Parameter == "ageGroup<1 year" ~ "$\\hat{\\beta}_{<1 year}$",
           Parameter == "ageGroup1-4 years" ~ "$\\hat{\\beta}_{1-4 years}$",
           Parameter == "ageGroup5-14 years" ~ "$\\hat{\\beta}_{5-14 years}$",
           Parameter == "ageGroup15-24 years" ~ "$\\hat{\\beta}_{15-24 years}$",
           Parameter == "ageGroup25-64 years" ~ "$\\hat{\\beta}_{25-64 years}$",
           Parameter == "ageGroup<65 years" ~ "$\\hat{\\beta}_{<65 years}$",
           Parameter == "ageGroup65+ years" ~ "$\\hat{\\beta}_{65+ years}$",
           Parameter == "t" ~ "$\\hat{\\beta}_{trend}$",
           Parameter == "log_sigma" ~ "$\\log(\\hat{\\sigma})$",
           Parameter == "log_phi" ~ "$\\log(\\hat{\\phi})$",
           Parameter == "sin(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\sin}$",
           Parameter == "cos(pi/6 * periodInYear)" ~ "$\\hat{\\beta}_{\\cos}$"
         )) %>%
  mutate(Formula = case_when(
    Formula == "ageGroup" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t +\\log(n_{it})\\end{math}",
    Formula == "ageGroup_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{\\sin}\\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}",
    Formula == "ageGroup_trend_seasonality" ~ "\\begin{math}\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t + \\beta_{\\sin} \\sin\\Big(\\frac{\\pi\\cdot \\tau_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot \\tau_{t}}{6}\\Big)+\\log(n_{it})\\end{math}"
  )) %>%
  select(`   ` = Model, `  ` = Formula, ` ` = avgLogS, Parameter, Estimate = theta, `95\\% CI`) %>%
  kbl(booktabs = TRUE, escape = FALSE, align = "l", longtable = TRUE, caption = "SALM modeling results. The average logarithmic score, $\\bar{S}(G, y)$, is computed for all the fixed effects models. The parameters are estimated in a rolling window with width $k=36$ and the estimates at time $t_0$, i.e. the last time point, are presented in this table for both modeling frameworks. Confidence intervals for the parameter estimates are calculated using 95\\% profile likelihood confidence intervals.") %>%
  kable_paper(latex_options = c("repeat_header", "HOLD_position"), repeat_header_method = c("replace")) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                valign = "middle",
                custom_latex_hline = 1:3)

```

(ref:SALMnovelparplot) Considering SALM in the time period between January 2011 and December 2022. Estimate (solid line) and 95% profile likelihood confidence interval (dashed line) of $\hat\theta$ for the considered fixed effects models estimated using the rolling window with a width of $k=36$ months. 

```{r SALMnovelparplot, echo=FALSE, out.width="100%", fig.cap="(ref:SALMnovelparplot)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/SALM_novel_par_plot.png")
```

