\chapter{Case studies}


This chapter presents the findings obtained by applying both the state-of-the-art outbreak detection algorithm and the novel outbreak detection algorithm to the subset of diseases examined in this master's thesis. The performance of these algorithms in identifying outbreaks within the selected diseases will be extensively discussed and analyzed. Additionally, a comprehensive comparative analysis will be conducted to offer valuable insights into the strengths and limitations of both the state-of-the-art algorithms and, more importantly, the novel algorithms. For a detailed presentation of the data used to generate these results, please refer to Chapter \@ref(Dataset).

To demonstrate the practical application of these algorithms, a comprehensive case study centered on STEC will be presented as the primary focus. Following that, the results of the remaining case studies will be presented in a more concise manner to keep the reader engaged. However, for the complete collection of related figures and tables, please refer to Appendix \@ref{FigAndTabCaseStudy}.

\section{Shiga toxin (verotoxin)-producing \textit{Escherichia coli}}

Initially, the ... is investigated.

ALL RESULTS REGARDING STEC IS GATHERED HERE

\subsection{Applying the state-of-the-art outbreak detection algorithm to Shiga toxin (verotoxin)-producing \textit{Escherichia coli}}

Initially, outbreak detection using the Farrington method and the Noufaily method, described in Section \@ref{StateOfTheArt}, are investigated. The methods are implemented in the `farringtonFlexible` function, which can be accessed through the R package known as \textbf{surveillance}. The `control` arguements for each of the methods can be found in Appendix \@ref{controlsStateOfTheArt}. The reference values for the analysis are based on data from January 2008 to February 2011. Subsequently, surveillance is conducted using the data from March 2011 to December 2021. The resulting series is visualized in Figure \@ref(fig:CompareStateOfTheArtSTEC).

(ref:CompareStateOfTheArtSTEC) Monthly Shiga toxin (verotoxin)-producing \textit{Escherichia coli} incidence per 100.000 in Denmark, 2008-2022. Monitored by (left) Farrington and (right) Noufaily method. Reference data for the estimation of model parameters from January 2008 to March 2011 (grey area). Threshold (dashed line) is computed for observations timepoints outside reference data. Alarm triggered (full opacity) if observations exceeds threshold. 

```{r CompareStateOfTheArtSTEC, echo=FALSE, out.width="100%", fig.cap="(ref:CompareStateOfTheArtSTEC)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_stateOfTheArt_STEC.png")
```

In Figure \@ref(fig:CompareStateOfTheArtSTEC), multiple alarms is observed for both the Farrington method and the Noufaily method. The Farrington method triggers a total of `r STEC_alarms_Farrington %>% summarize(nAlarm = sum(alarm)) %>% .$nAlarm` alarms, while the Noufaily method produces slightly fewer, specifically `r STEC_alarms_Noufaily %>% summarize(nAlarm = sum(alarm)) %>% .$nAlarm` alarms.

\subsection{Applying the novel outbreak detection algorithm to Shiga toxin (verotoxin)-producing \textit{Escherichia coli}}



```{r STECNovelTbl, echo=FALSE}

row_group_label_fonts <- list(
list(bold = TRUE, italic = TRUE),
list(bold = FALSE, italic = FALSE)
)

STEC_novel_tbl %>%
  mutate(`Estimate (CI)` = paste0(round(theta,2), " (",round(CI.lwr,2),", ",round(CI.upr,2),")"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         Parameter = case_when(
           Parameter == "ageGroup<65 years" ~ "$\\beta_{<65 years}$",
           Parameter == "ageGroup65+ years" ~ "$\\beta_{65+ years}$",
           Parameter == "t" ~ "$\\beta_{trend}$",
           Parameter == "log_sigma" ~ "$\\log(\\sigma)$",
           Parameter == "log_phi" ~ "$\\log(\\phi)$",
           Parameter == "sin(pi/6 * monthInYear)" ~ "$\\beta_{\\sin}$",
           Parameter == "cos(pi/6 * monthInYear)" ~ "$\\beta_{\\cos}$"
         )) %>%
  mutate(Formula = gsub(pattern = "_", replacement = "", x = Formula)) %>%
  # mutate(Formula = case_when(
  #   Formula == "ageGroup" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})$",
  #   Formula == "ageGroup_trend" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t +\\log(n_{it})$",
  #   Formula == "ageGroup_seasonality" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{\\sin}\\sin\\Big(\\frac{\\pi\\cdot monthInYear_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot monthInYear_{t}}{6}\\Big)+\\log(n_{it})$",
  #   Formula == "ageGroup_trend_seasonality" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t + \\beta_{\\sin} \\sin\\Big(\\frac{\\pi\\cdot monthInYear_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot monthInYear_{t}}{6}\\Big)+\\log(n_{it})$"
  # )) %>%
  select(Model, Formula, avgLogS, Parameter, `Estimate (CI)`) %>%
  kbl(booktabs = TRUE, escape = FALSE) %>%
  kable_paper() %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                custom_latex_hline = 1:3)

```





\begin{equation}
  \log(\lambda_{it})=\beta(ageGroup_{i})+\log(n_{it})
\end{equation}

\begin{equation}
  \log(\lambda_{it})=\beta(ageGroup_{i})+ \sin \big(\frac{\pi\cdot \tau_t}{6}\big) \beta_{\sin} + \cos \big(\frac{\pi\cdot \tau_t}{6}\big) \beta_{\cos} + \log(n_{it})
\end{equation}

Here $\tau_t$ represents the month in year as a decimal number (01-12)-

(ref:CompareStateOfTheArt) Placeholder caption 

```{r CompareStateOfTheArt, echo=FALSE, out.width="100%", fig.cap="(ref:CompareStateOfTheArt)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_stateOfTheArt.png")
```

(ref:CompareNovel) Placeholder caption 

```{r CompareNovel, echo=FALSE, out.width="100%", fig.cap="(ref:CompareNovel)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_novel.png")
```





\section{\textit{Listeriosis}}

ALL THE RESULTS REGARDING \textit{LISTERIOSIS} IS GATHERED HERE!

\subsection{Applying the state-of-the-art outbreak detection algorithm to \textit{Listeriosis}}

Initially, outbreak detection using the Farrington method and the Noufaily method, described in Section \@ref(StateOfTheArt), are investigated. The methods are implemented in the `farringtonFlexible` function, which can be accessed through a R package known as \textbf{surveillance}. The `control` arguments for each of the functions can be found in Appendix \@ref(controlsStateOfTheArt). The reference values for the analysis are based on the data from January 2008 to February 2011. Subsequently, surveillance is conducted using the data from March 2011 to December 2021. The resulting series is visualized in Figure \@ref(fig:CompareStateOfTheArtLIST).

(ref:CompareStateOfTheArtLIST) Monthly \textit{Listeriosis} incidence per 100.000 in Denmark, 2008-2022. Monitored by (left) Farrington and (right) Noufaily method. Reference data for the estimation of model parameters from January 2008 to March 2011 (grey area). Threshold (dashed line) is computed for observations timepoints outside reference data. Alarm triggered (full opacity) if observations exceeds threshold. 

```{r CompareStateOfTheArtLIST, echo=FALSE, out.width="100%", fig.cap="(ref:CompareStateOfTheArtLIST)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_stateOfTheArt_LIST.png")
```

In Figure \@ref(fig:CompareStateOfTheArtLIST), multiple alarms can be observed for both the Farrington method and the Noufaily method. The Farrington method triggers a total of `r LIST_alarms_Farrington %>% summarize(nAlarm = sum(alarm)) %>% .$nAlarm` alarms, while the Noufaily method produces slightly fewer, specifically `r LIST_alarms_Noufaily %>% summarize(nAlarm = sum(alarm)) %>% .$nAlarm` alarms.

Interestingly, both the Farrington method and the Noufaily method demonstrate the ability to correctly raise alarms during ongoing outbreak investigations by SSI. One notable example is the outbreak investigated by SSI, which involved 41 cases and resulted in 17 deaths. The Farrington method successfully flags this event in September 2013, with alarms occurring sporadically in the subsequent period. The Noufaily method also identifies this outbreak, although it does so one month later in October 2013.

It is worth noting that the other observations flagged by the methods may be related to some of the numerous other long-spanned outbreaks that occurred concurrently in the period from 2016 to 2021. For a full list over the observations flagged by the state-of-the-art outbreak detection algorithms see Table \@ref(tab:LISTStateOfTheArtTbl).

\subsection{Applying the novel outbreak detection algorithm to \textit{Listeriosis}}

At this stage, the novel outbreak detection algorithm presented in Section \@ref(Novel) is evaluated on its ability to detect outbreaks of \textit{Listeriosis}. 

In both cases, a suite of models with increasing complexity is investigated and ...

\begin{equation}
  \log(\lambda_{it})=\beta(ageGroup_{i})+\log(n_{it})
\end{equation}

\begin{equation}
  \log(\lambda_{it})=\beta(ageGroup_{i})+\beta_{trend} t +\log(n_{it})
\end{equation}

\begin{equation}
  \log(\lambda_{it})=\beta(ageGroup_{i})+\beta_{trend} t + \beta_{\sin} \sin\Big(\frac{\pi\cdot monthInYear_t}{6}\Big) + \beta_{\cos} \cos\Big(\frac{\pi \cdot monthInYear_t}{6}\Big)
\end{equation}


```{r LISTNovelTbl, echo=FALSE}

row_group_label_fonts <- list(
list(bold = TRUE, italic = TRUE),
list(bold = FALSE, italic = FALSE)
)

LIST_novel_tbl %>%
  mutate(`Estimate (CI)` = paste0(round(theta,2), " (",round(CI.lwr,2),", ",round(CI.upr,2),")"),
         Model = case_when(
           grepl(pattern = "PoisN_", x = method) ~ "Poisson Normal",
           grepl(pattern = "PoisG_", x = method) ~ "Poisson Gamma"
           ),
         Formula = gsub(pattern = "PoisN_|PoisG_", replacement = "", x = method),
         Parameter = case_when(
           Parameter == "ageGroup<65 years" ~ "$\\beta_{<65 years}$",
           Parameter == "ageGroup65+ years" ~ "$\\beta_{65+ years}$",
           Parameter == "t" ~ "$\\beta_{trend}$",
           Parameter == "log_sigma" ~ "$\\log(\\sigma)$",
           Parameter == "log_phi" ~ "$\\log(\\phi)$",
           Parameter == "sin(pi/6 * monthInYear)" ~ "$\\beta_{\\sin}$",
           Parameter == "cos(pi/6 * monthInYear)" ~ "$\\beta_{\\cos}$"
         )) %>%
  mutate(Formula = gsub(pattern = "_", replacement = "", x = Formula)) %>%
  # mutate(Formula = case_when(
  #   Formula == "ageGroup" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\log(n_{it})$",
  #   Formula == "ageGroup_trend" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t +\\log(n_{it})$",
  #   Formula == "ageGroup_seasonality" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{\\sin}\\sin\\Big(\\frac{\\pi\\cdot monthInYear_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot monthInYear_{t}}{6}\\Big)+\\log(n_{it})$",
  #   Formula == "ageGroup_trend_seasonality" ~ "$\\log(\\lambda_{it})=\\beta(ageGroup_{i})+\\beta_{trend} t + \\beta_{\\sin} \\sin\\Big(\\frac{\\pi\\cdot monthInYear_{t}}{6}\\Big) + \\beta_{\\cos} \\cos\\Big(\\frac{\\pi \\cdot monthInYear_{t}}{6}\\Big)+\\log(n_{it})$"
  # )) %>%
  select(Model, Formula, avgLogS, `$\\theta$` = Parameter, `Estimate (CI)`) %>%
  kbl(booktabs = TRUE, escape = FALSE) %>%
  kable_paper() %>%
  collapse_rows(columns = 1:3, 
                row_group_label_position = "stack",
                row_group_label_fonts = row_group_label_fonts,
                latex_hline = "custom",
                custom_latex_hline = 1:3)

```


INCLUDE A TABLE WITH SCORING!

WRITE SOMETHING ABOUT MODEL SELECTION!

(ref:CompareNovelLIST) One-step ahead random effects $u_{t_1}$ of \textit{Listeriosis} in Denmark, 2011-2022, as circles. Poisson Normal model (top) and Poisson Gamma model (bottom) monitor the disease. Alarm raised (solid circle) if $u_{t_1}$ exceeds the threshold (dashed line).

```{r CompareNovelLIST, echo=FALSE, out.width="100%", fig.cap="(ref:CompareNovelLIST)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_novel_LIST.png")
```

The one-step ahead random effects $u_{t_1}$ for the disease are visualized in Figure \@ref(fig:CompareNovelLIST). It is clear that the models struggle to adequately describe the underlying process of the disease. Only a single alarm is raised in`r format(LIST_alarms$alarms, "%B %Y")`, which is in the midst of several concurrent outbreaks investigated by SSI, with several observations being borderline significant. When compared to the numerous outbreaks investigated by SSI in the same time period, this is not an impressive result. However, it is important to note that the current state-of-the-art detection method for \textit{Listeriosis} is laboratory-based and requires the use of WGS to link cases that occurred over an extended time period. Moreover, the start of outbreaks with \textit{Listeriosis} are usually dated back to the first identified case, which can be up to several months prior to the peak of the disease.


Mostly, it is noted that the Poisson Gamma model seems more robust, than the Poisson Normal model. Specifically, this is observed in periods with low case counts, i.e. in November 2011, from August 2013 to January 2014, in February 2019, and again in the period from June 2020 to November 2021. 

Apart from the Poisson Gamma model being seemingly more robust, the estimated fixed effects parameters for the models are on a comparable scale. This can be seen in Figure \@ref(fig:LISTnovelparageGroup)


(ref:LISTnovelparageGroup) Placeholder caption

```{r LISTnovelparageGroup, echo=FALSE, out.width="100%", fig.cap="(ref:LISTnovelparageGroup)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/LIST_novel_par_ageGroup.png")
```


(ref:LISTnovelparDispersion) Placeholder caption

```{r LISTnovelparDispersion, echo=FALSE, out.width="100%", fig.cap="(ref:LISTnovelparDispersion)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/LIST_novel_par_dispersion.png")
```



Consider the models given in \eqref{eq:PoisN} and \eqref{eq:PoisGam}


\section{\textit{Shiggellosis}}

ALL THE RESULTS REGARDING \textit{LISTERIOSIS} IS GATHERED HERE!

\subsection{Applying the state-of-the-art outbreak detection algorithm to \textit{Shigellosis}}

(ref:CompareStateOfTheArtSHIG) Monthly \textit{Shigellosis} incidence per 100.000 in Denmark, 2008-2022. Monitored by (left) Farrington and (right) Noufaily method. Reference data for the estimation of model parameters from January 2008 to March 2011 (grey area). Threshold (dashed line) is computed for observations timepoints outside reference data. Alarm triggered (full opacity) if observations exceeds threshold. 

```{r CompareStateOfTheArtSHIG, echo=FALSE, out.width="100%", fig.cap="(ref:CompareStateOfTheArtSHIG)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_stateOfTheArt_SHIG.png")
```

\subsection{Applying the novel outbreak detection algorithm to \textit{Shigellosis}}







\section{\textit{Salmonellosis}}

\subsection{Applying the state-of-the-art outbreak detection algorithm to \textit{Salmonellosis}}

(ref:CompareStateOfTheArtSALM) Monthly \textit{Salmonellosis} incidence per 100.000 in Denmark, 2008-2022. Monitored by (left) Farrington and (right) Noufaily method. Reference data for the estimation of model parameters from January 2008 to March 2011 (grey area). Threshold (dashed line) is computed for observations timepoints outside reference data. Alarm triggered (full opacity) if observations exceeds threshold. 

```{r CompareStateOfTheArtSALM, echo=FALSE, out.width="100%", fig.cap="(ref:CompareStateOfTheArtSALM)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_stateOfTheArt_SALM.png")
```

\subsection{Applying the novel outbreak detection algorithm to \textit{Salmonellosis}}


\section{Performance comparison of novel methods}

(ref:CompareAlarms) Placeholder caption 

```{r CompareAlarms, echo=FALSE, out.width="100%", fig.cap="(ref:CompareAlarms)", fig.pos = "H", fig.show = "hold"}
knitr::include_graphics("../figures/Compare_alarms.png")
```



\cleardoublepage

